From a34ab2b48d9259cfd07a7f61c33fb028be957547 Mon Sep 17 00:00:00 2001
From: Bumsik Kim <k.bumsik@gmail.com>
Date: Mon, 27 Apr 2020 15:04:16 +0900
Subject: [PATCH 1/4] add blogsearch in gatsby-config.js

---
 gatsby-config.js | 76 ++++++++++++++++++++++++++++++++++++++++++++++++
 1 file changed, 76 insertions(+)

diff --git a/gatsby-config.js b/gatsby-config.js
index 2637eac9..3e5633ff 100644
--- a/gatsby-config.js
+++ b/gatsby-config.js
@@ -17,6 +17,82 @@ module.exports = {
     'MarkdownRemark.frontmatter.author': 'AuthorYaml',
   },
   plugins: [
+    {
+      resolve: 'gatsby-plugin-blogsearch',
+      options: {
+        // Generated blogsearch database file.
+        output: 'reactjs.org.gatsby-example.db.wasm',
+        // fields configurations
+        fields: {
+          title: {
+            enabled: true,
+            indexed: true,
+            hasContent: true,
+          },
+          body: {
+            enabled: true,
+            indexed: true,
+            hasContent: true,
+          },
+          url: {
+            enabled: true,
+            indexed: true,
+            hasContent: true,
+          },
+          categories: {
+            enabled: true,
+            indexed: true,
+            hasContent: true,
+          },
+          tags: {
+            enabled: true,
+            indexed: true,
+            hasContent: true,
+          },
+        },
+        // GraphQL query used to fetch all data for the search index. This is
+        // required.
+        query: `
+        {
+          allMarkdownRemark {
+            edges {
+              node {
+                fields {
+                  slug
+                }
+                frontmatter {
+                  title
+                }
+                rawMarkdownBody
+                # excerpt
+                # html
+              }
+            }
+          }
+        }
+        `,
+        // Function used to map the result from the GraphQL query. This should
+        // return an array of items to index in the form of flat objects
+        // containing properties to index. The objects must contain the `ref`
+        // field above (default: 'id'). This is required.
+        normalizer: ({ data }) =>
+          data.allMarkdownRemark.edges.map(({ node }, siteUrl) => {
+            return {
+              title: node.frontmatter.title,
+              body: node.rawMarkdownBody
+                      .replace(/[#`\[\]]+/g, '')
+                      .replace(/\(.*\)/g, '')
+                      .replace(/\s+/g, ' '),
+              url: siteUrl + node.fields.slug,
+              categories: (() => {
+                const slug = node.fields.slug;
+                return slug ? slug.substring(0, slug.indexOf('/')) : '';
+              })(),
+              tags: '',
+            };
+          }),
+      },
+    },
     'gatsby-source-react-error-codes',
     'gatsby-transformer-authors-yaml',
     'gatsby-transformer-home-example-code',
-- 
2.26.2

